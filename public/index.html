<!DOCTYPE html>
<html>
  <head>
    <title>GizMotion Photobooth</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes"/>
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <script type="text/javascript" src="js/xhr.js"></script>
    <script type="text/javascript">
      let MAX_IMAGE_COUNT = 3;
      let images = [];
      var count = 3;

      function countDown() {
        let countLabel = document.getElementById("countLabel");

        if (count > 0) {
          countLabel.innerHTML = String(count);
          count--;
          setTimeout(countDown, 1000)
        }
        else {
          countLabel.innerHTML = "";
          count = 3;
          snapPhoto();
        }
      }

      function snapPhoto() {
        xhr.get("/picture", showPhoto);
      }

      function showPhoto(err, data) {
        if (data && data.success) {
          let photos = document.getElementById("photos");
          let image = new Image();

          image.width = 128;
          image.height = 96;
          image.src = data.filename;

          images.push(image);

          if (images.length > MAX_IMAGE_COUNT) {
            let firstImage = images.shift();

            photos.removeChild(firstImage);
          }

          photos.appendChild(image);
        }
      }
    </script>
  </head>
  <body>
    <div class="content">
      <div class="center">
        <img class="center" src="http://192.168.0.1:8080/stream/video.mjpeg" width="320" height="240"/>
    </div>
    <div class="photos">
      <input type="button" onclick="countDown()" value="Snap Photo" />
      <div id="photos"></div>
      <p id="countLabel"></p>
    </div>
  </body>
</html>
